package com.mr.step.service.impl;

import java.text.ParseException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.Calendar;
import java.util.Date;
import java.util.GregorianCalendar;
import java.util.List;

import org.apache.commons.collections.CollectionUtils;
import org.apache.commons.configuration.XMLConfiguration;
import org.apache.log4j.Logger;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.base.service.BaseService;
import com.common.file.domain.MrAtchFile;
import com.common.file.repository.MrAtchFileRepository;
import com.common.file.service.MrAtchFileService;
import com.mr.mrrq.domain.MRrqRegisterVO;
import com.mr.step.domain.ChrgrChgHist;
import com.mr.step.domain.MrReqProcStepDetVO;
import com.mr.step.domain.MrReqProcStepVO;
import com.mr.step.repository.MrStepRepository;
import com.mr.step.service.MrStepService;

@Service
public class MrStepServiceImpl extends BaseService implements MrStepService {
    private final Logger logger = Logger.getLogger(this.getClass());

    @Autowired
    MrStepRepository mrStepRepository;

    @Autowired
    MrAtchFileRepository mrAtchFileRepository;

    @Autowired
    MrAtchFileService mrAtchFileService;

    @Autowired
    private XMLConfiguration appConfig;

    /**
     * 화면처리 및 단계처리를 위한 모드 권한 반환
     */
    @Override
    public String getModeClass(int mrReqNo) {
        String modeClass ="" ;
        ChrgrChgHist chrgrChgHist = new ChrgrChgHist();
        chrgrChgHist.setMrReqNo(mrReqNo);

        //현재 진행중인 단계의 정보 조회
        ChrgrChgHist appInfo = mrStepRepository.selectAppStepEmp(mrReqNo,null);

        /**
         * 진행중인 단계가 없을경우 FFF로 처리
         * 모드처리문자는 다음과 같은 규칙을 가진다.
         * 1자리 : MR_STEP_CD
         * 2자리 : PROC_ST_CD
         * 3자리 : 해당담당자 일경우 A 담당자가 아닐경우 B 
         * ======================================================
         *
         * 동시에 진행해야 하는 경우 하단에 STEP 번호를 OR 조건으로 추가하세요.
         *
         *
         */
        System.out.println("modeClass:"+ modeClass);
        System.out.println("appInfo.getMrStepCd():" + appInfo.getMrStepCd());
        System.out.println("appInfo.getProcStCd():" + appInfo.getProcStCd());
        
        
        if (appInfo == null) {
            modeClass = "FFF";
        } else {
            switch (appInfo.getMrStepCd()) {
                case "Z0010":
                    modeClass += "A";
                    break;
                case "Z0020":
                    modeClass += "B";
                    break;
                case "Z0030":
                    modeClass += "C";
                    break;
                case "Z0040":
                    modeClass += "D";
                    break;
                case "Z0050":
                    modeClass += "E";
                    break;
                case "Z0060":
                    modeClass += "F";
                    break;
                case "Z0070":
                    modeClass += "G";
                    break;
                case "Z0080":
                    modeClass += "H";
                    break;
                case "Z0090":
                    modeClass += "I";
                    break;
                case "Z00Z0":
                    modeClass += "Z";
                    break;
            }

            if(modeClass.equals("A")||modeClass.equals("B")||modeClass.equals("C")||modeClass.equals("D")) {
                switch (appInfo.getProcStCd()) {
                    case "Z0110":
                        modeClass += "A";
                        break;
                    case "Z0121":
                        modeClass += "B";
                        break;
                    case "Z0122":
                        modeClass += "C";
                        break;
                    case "Z0133":
                        modeClass += "D";
                        break;
                    case "Z0131":
                        modeClass += "E";
                        break;
                    case "Z0141":
                        modeClass += "A";
                        break;
                }
            } else if (modeClass.equals("E")||modeClass.equals("F")||modeClass.equals("G")||modeClass.equals("H")||modeClass.equals("I")||modeClass.equals("Z")) {
                switch (appInfo.getProcStCd()) {
                    case "Z0110":
                        modeClass += "A";
                        break;
                    case "Z0121":
                        modeClass += "B";
                        break;
                    case "Z0131":
                        modeClass += "C";
                        break;
                    case "Z0122":
                        modeClass += "D";
                        break;
                    case "Z0132":
                        modeClass += "E";
                        break;
                    case "Z0123":
                        modeClass += "F";
                        break;
                    case "Z0133":
                        modeClass += "G";
                        break;
                    case "Z0141":
                        modeClass += "A";
                        break;
                    case "Z0142":
                        modeClass += "Z";
                        break;
                    case "Z0143":
                        modeClass += "Z";
                        break;
                }
            }
            //동시에 진행해야 하는 단계이면 여기에 추가하세요. 코드를 OR 조건으로 추가하세요.



            if(appInfo.getMrStepCd().equals("Z0030")|| appInfo.getMrStepCd().equals("Z0040")||appInfo.getMrStepCd().equals("Z0070")) {
                int appCount = 0;
                List<ChrgrChgHist> appInfoList = mrStepRepository.selectAppStepEmpMulti(mrReqNo);
                
                //20150827 Project Engineer 선택 수정 시작 :  설정 가능 인원 변경 수행팀장, 직책과장 -> 수행팀원으로                
                if(appInfo.getMrStepCd().equals("Z0030") && (appInfo.getProcStCd().equals("Z0110") || appInfo.getProcStCd().equals("Z0121"))){
                	//System.out.println(""+appInfo.getMrStepCd());

                	for(ChrgrChgHist appChrgrChgHist : appInfoList) {
                		
                    	//System.out.println("getProcStCd : " + appInfo.getProcStCd());
                    	//System.out.println("getChrgEmpNo : " + appChrgrChgHist.getChrgEmpNo());
                    	//System.out.println("getLoginEmpNo : " + chrgrChgHist.getLoginEmpNo());
                    	//System.out.println("getLoginTeamNo : " + chrgrChgHist.getLoginTeamNo());
                    	//System.out.println("getChrgTeamNo : " + appChrgrChgHist.getChrgTeamNo());
                    	
                		//if (appInfo.getProcStCd().equals("Z0110")) {   //초기투자비 작성 단계 동일팀 모두 변경 가능
                		if(chrgrChgHist.getLoginTeamNo().equals(appChrgrChgHist.getChrgTeamNo())) {
                		   appCount++;
                		}
                		//} else if (appInfo.getProcStCd().equals("Z0121")){  //초기투자비 요청 단계 담당자만 변경 가능
                    	//	if(chrgrChgHist.getLoginEmpNo().equals(appChrgrChgHist.getChrgEmpNo())) {
                    	//		appCount++;
                    	//	}
            		    //}
                	}                	
                }
                else {
                	for(ChrgrChgHist appChrgrChgHist : appInfoList) {
                		if(chrgrChgHist.getLoginEmpNo().equals(appChrgrChgHist.getChrgEmpNo())) {
                			appCount++;
                		}
                	}
                }                
                                
                if(appCount>0) {
                    modeClass += "A";
                } else {
                    modeClass += "B";
                }

            } else {

                // 기술항목 검토 승인 기능 사용을 위함.
            	//if(appInfo.getMrStepCd().equals("Z0020") && chrgrChgHist.getLoginEmpNo().equals("199390")) {
                //    modeClass += "I";
                //} else if(chrgrChgHist.getLoginEmpNo().equals(appInfo.getChrgEmpNo())) {
            	if(chrgrChgHist.getLoginEmpNo().equals(appInfo.getChrgEmpNo())) {
                    if(appInfo.getMrStepCd().equals("Z0060") && appInfo.getChrgrClCd().equals("Z02I")) {
                       modeClass += "I";
                    } else if(appInfo.getMrStepCd().equals("Z0060") && appInfo.getChrgrClCd().equals("Z02D")) {
                    	modeClass += "D"; //201905 기술검토자일 경우 
                    } else {
                	   modeClass += "A";
                    }
                } else {
                    modeClass += "B";
                }
            }
        }

        return modeClass;
    }


    /*
     * 
     * */
    @Override
    public String isolationModeClass(int mrReqNo, String mrStepCd, List<String> ingMrStepCd, String chrgrClCd, boolean isMulti) {
        String modeClass = "I";

        ChrgrChgHist chrgrChgHist = new ChrgrChgHist();
        ChrgrChgHist appInfo = mrStepRepository.selectAppIsolationStepEmp(mrReqNo, mrStepCd, chrgrClCd);
        ChrgrChgHist currentAppInfo = mrStepRepository.selectAppStepEmp(mrReqNo,null);

        for (String targetMrStepCd : ingMrStepCd){
            if(currentAppInfo != null && currentAppInfo.getMrStepCd().equals(targetMrStepCd)){
                modeClass += "A";
                break;
            }
        }

        if(appInfo!=null && !isMulti){
            int clCdLength = appInfo.getChrgrClCd().length();
            String clCd = appInfo.getChrgrClCd().substring(clCdLength-1);

            if(chrgrChgHist.getLoginEmpNo().equals(appInfo.getChrgEmpNo())) {
                modeClass += clCd;
            } else {
                modeClass += "NN";
            }
        } else if (isMulti) {

            List<ChrgrChgHist> mutiAppLine = mrStepRepository.selectIsolationAppStepEmpMulti(mrReqNo, mrStepCd, chrgrClCd);
            for (ChrgrChgHist chrgrChgHistCheck : mutiAppLine){
                if(chrgrChgHistCheck.getChrgEmpNo().equals(chrgrChgHist.getLoginEmpNo())){
                    modeClass += "SA";
                    break;
                }
            }
        } else {
            modeClass += "FF";
        }
        return modeClass;
    }

    @Override
    public String getSubModeClass(int mrReqNo, String chrgrClCd, String mrStepCd, boolean isLike) {
        ChrgrChgHist loginInfo = new ChrgrChgHist();
        List<ChrgrChgHist> appInfoList = mrStepRepository.selectAppStepEmpMulti(mrReqNo);
        ChrgrChgHist appInfo = mrStepRepository.selectAppStepEmp(mrReqNo,null);
        String subModeClass = "";
        for(ChrgrChgHist chrgrChgHist : appInfoList) {
            subModeClass = "S-A";

            if(!isLike && chrgrChgHist.getChrgrClCd().equals(chrgrClCd)) {
                subModeClass += "A";
            }

            if(isLike && chrgrChgHist.getChrgrClCd().contains(chrgrClCd)) {
                subModeClass += "L";
            }

            if((appInfo.getMrStepCd().equals(mrStepCd) && chrgrChgHist.getChrgEmpNo().equals(loginInfo.getLoginEmpNo())) || (chrgrChgHist.getJobRvCd()!=null && chrgrChgHist.getJobRvCd().equals("SKIP"))){
                subModeClass += "A";
            }

            if(subModeClass.equals("S-AAA") || subModeClass.equals("S-ALA")) {
                break;
            }
        }

        return subModeClass;
    }

    /**
     * 화면 좌측 메뉴 상태 표시용 STEP 반환
     */
    @Override
    public List<MrReqProcStepVO> selectAllMrReqStep(int mrReqNo) {
        List<MrReqProcStepVO> mrReqProcStepVOs = mrStepRepository.selectAllMrReqStep(mrReqNo);
        if(mrReqNo==0) {
            MrReqProcStepVO mrReqProcStepVO = new MrReqProcStepVO();
            mrReqProcStepVO.setMrStepCd("Z0010");
            mrReqProcStepVO.setProcStCd("Z0110");
            mrReqProcStepVO.setProcStNm("작성중");
            mrReqProcStepVOs.add(mrReqProcStepVO);
        }
        return mrReqProcStepVOs;
    }

    /**
     * STEP을 생성하거나 변경 그리고 담당자를 변경한다.
     */
    @Override
    public int insertMrStep(int mrReqNo, String mrStepCd, String procStCd, List<ChrgrChgHist> appLine){
    	
        int mrReqProcStepNo = 0; 

        if(procStCd!=null){

            //STEP을 신규로 생성한다.
            MrReqProcStepVO mrReqProcStepVO = new MrReqProcStepVO();
            mrReqProcStepVO.setMrReqNo(mrReqNo);
            mrReqProcStepVO.setMrStepCd(mrStepCd);
            mrReqProcStepVO.setProcStCd(procStCd);            
            
            //Step 생성            
            mrStepRepository.insertProcStep(mrReqProcStepVO);
            
            //마스터 테이블 STEP 업데이트
            mrStepRepository.updateMrReqStep(mrReqProcStepVO);
            
            mrReqProcStepNo = mrReqProcStepVO.getMrReqProcStepNo();
        } else {
            //논리 삭제를 위하여 담당자 변경 객체 생성
            //mrReqNo를 셋팅하고 있으나 객체 생성시 자동으로 loginEmp를 세션으로 부터 얻어옴.
            ChrgrChgHist appInfo = mrStepRepository.selectAppStepEmp(mrReqNo, null);

            //반려상태가 있을수 있으므로 업데이트시에는 procStCd를 다시 셋팅해준다.
            procStCd = appInfo.getProcStCd();

            //상세 DET 단부터는 논리삭제후 처리하므로 STEP 번호가 필요함.
            mrReqProcStepNo = appInfo.getMrReqProcStepNo();

            //상세 Step 논리삭제
            mrStepRepository.updateMrReqProcStepDetDelYn(appInfo);
            
            //결재라인 논리삭제
            mrStepRepository.updateAppLineDelYn(appInfo);
            System.out.println("updateAppLineDelYn  끝 :: ");
        }
        
        //결재자정보를 새로 생성한다.
        System.out.println("ChrgrChgHist  appLine 결재자정보 :: ");
        for (ChrgrChgHist chrgrChgHist: appLine) {
            if(chrgrChgHist.getChrgEmpNo() ==null) {
                continue;
            }
            
            MrReqProcStepDetVO mrReqProcStepDetVO = new MrReqProcStepDetVO();
            mrReqProcStepDetVO.setMrReqNo(mrReqNo);
            mrReqProcStepDetVO.setMrReqProcStepNo(mrReqProcStepNo);
            mrReqProcStepDetVO.setMrStepCd(mrStepCd);
            mrReqProcStepDetVO.setProcStCd(procStCd);
            mrReqProcStepDetVO.setFstProcTrmDt(chrgrChgHist.getProcTrmDt());
            mrStepRepository.insertMrReqProcStepDet(mrReqProcStepDetVO);

            chrgrChgHist.setMrReqNo(mrReqNo);
            chrgrChgHist.setMrReqProcStepDetNo(mrReqProcStepDetVO.getMrReqProcStepDetNo());
            
            mrStepRepository.insertChrgrChgHist(chrgrChgHist); 
        }
        System.out.println("ChrgrChgHist  appLine 결재자정보 끝 :: ");
        return mrReqProcStepNo;
    }   
    
    /**
     * 직무검토자 입력 서비스
     */
    @Override
    public void insertTechEmp(int mrReqNo, int mrReqProcStepNo, String mrStepCd, String procStCd, List<ChrgrChgHist> techEmps) {

        for (ChrgrChgHist chrgrChgHist: techEmps) {
            if(chrgrChgHist.getChrgEmpNo() ==null) {
                continue;
            }
            MrReqProcStepDetVO mrReqProcStepDetVO = new MrReqProcStepDetVO();
            mrReqProcStepDetVO.setMrReqNo(mrReqNo);
            mrReqProcStepDetVO.setMrReqProcStepNo(mrReqProcStepNo);
            mrReqProcStepDetVO.setMrStepCd(mrStepCd);
            mrReqProcStepDetVO.setProcStCd(procStCd);
            mrReqProcStepDetVO.setFstProcTrmDt(chrgrChgHist.getProcTrmDt());
            
	        //상세 Step 생성
            mrStepRepository.insertMrReqProcStepDet(mrReqProcStepDetVO);

            chrgrChgHist.setMrReqNo(mrReqNo);
            chrgrChgHist.setMrReqProcStepDetNo(mrReqProcStepDetVO.getMrReqProcStepDetNo());
            
            //결재라인생성
            mrStepRepository.insertChrgrChgHist(chrgrChgHist);            
        }
    }

    /**
     * 보통 다음 단계 담당자 활성화시 사용한다. 상세 STEP만 변경시 사용하지 않도록 주의
     */
    @Override
    public void insertMrStepSingleAction(int mrReqNo, String mrStepCd, String procStCd, String chrgrClCd) {

        ChrgrChgHist chrgrChgHist = mrStepRepository.selectAppStepEmp(mrReqNo, chrgrClCd);
        chrgrChgHist.setMrReqNo(mrReqNo);
        mrStepRepository.updateProcStepEffEnd(chrgrChgHist);

        MrReqProcStepVO mrReqProcStepVO = new MrReqProcStepVO();
        mrReqProcStepVO.setMrReqNo(mrReqNo);
        mrReqProcStepVO.setMrStepCd(mrStepCd);
        mrReqProcStepVO.setProcStCd(procStCd);
        mrStepRepository.insertProcStep(mrReqProcStepVO);
        mrStepRepository.updateMrReqStep(mrReqProcStepVO);

        MrReqProcStepDetVO mrReqProcStepDetVO = new MrReqProcStepDetVO();
        mrReqProcStepDetVO.setMrReqNo(mrReqNo);
        mrReqProcStepDetVO.setMrReqProcStepNo(mrReqProcStepVO.getMrReqProcStepNo());
        mrReqProcStepDetVO.setMrStepCd(mrStepCd);
        mrReqProcStepDetVO.setProcStCd(procStCd);
        mrReqProcStepDetVO.setFstProcTrmDt(getAppTerm());
        mrStepRepository.insertMrReqProcStepDet(mrReqProcStepDetVO);

        chrgrChgHist.setProcStCd(procStCd);
        chrgrChgHist.setMrReqProcStepDetNo(mrReqProcStepDetVO.getMrReqProcStepDetNo());
        mrStepRepository.insertChrgrChgHist(chrgrChgHist);
    }

    /**
     * 동시에 처리가 필요한 단계를 호출할때 처리하세요.
     */

    @Override
    public void insertMrStepMultiAction(int mrReqNo, String mrStepCd, String procStCd, List<ChrgrChgHist> appLine, String lastAppChrgrClCd){
        ChrgrChgHist appInfo = mrStepRepository.selectAppStepEmp(mrReqNo, lastAppChrgrClCd);
        appInfo.setMrReqNo(mrReqNo);
        mrStepRepository.updateProcStepEffEnd(appInfo);

        MrReqProcStepVO mrReqProcStepVO = new MrReqProcStepVO();
        mrReqProcStepVO.setMrReqNo(mrReqNo);
        mrReqProcStepVO.setMrStepCd(mrStepCd);
        mrReqProcStepVO.setProcStCd(procStCd);
        mrStepRepository.insertProcStep(mrReqProcStepVO);
        mrStepRepository.updateMrReqStep(mrReqProcStepVO);

        for (ChrgrChgHist chrgrChgHist: appLine) {
            if(chrgrChgHist.getChrgEmpNo() ==null) {
                continue;
            }
            MrReqProcStepDetVO mrReqProcStepDetVO = new MrReqProcStepDetVO();
            mrReqProcStepDetVO.setMrReqNo(mrReqNo);
            mrReqProcStepDetVO.setMrReqProcStepNo(mrReqProcStepVO.getMrReqProcStepNo());
            mrReqProcStepDetVO.setMrStepCd(mrStepCd);
            mrReqProcStepDetVO.setProcStCd(procStCd);
            if("Z0020".equals(mrStepCd) && "Z0110".equals(procStCd) && ("Z02G".equals(chrgrChgHist.getChrgrClCd()) || "Z02G1".equals(chrgrChgHist.getChrgrClCd()))){
                mrReqProcStepDetVO.setFstProcTrmDt(null);
            }else{
            	mrReqProcStepDetVO.setFstProcTrmDt(getAppTerm());
            }
            mrStepRepository.insertMrReqProcStepDet(mrReqProcStepDetVO);

            chrgrChgHist.setMrReqNo(mrReqNo);
            chrgrChgHist.setProcStCd(procStCd);
            chrgrChgHist.setMrReqProcStepDetNo(mrReqProcStepDetVO.getMrReqProcStepDetNo());
            mrStepRepository.insertChrgrChgHist(chrgrChgHist);
        }
    }

    /**
     * 다음 담당자를 입력받지 않고 이전에 DB에 저장된 데이터를 기준으로 조회하여 활성화 할때 사용함.
     */
    @Override
    public void updateMrStep(int mrReqNo, String currentMrStepCd, String nextProcStCd, String nextChrgrClCd, String getMrStepCd, String getChrgrClCd) {

        MrReqProcStepVO mrReqProcStepVO = new MrReqProcStepVO();
        mrReqProcStepVO.setMrReqNo(mrReqNo);
        mrReqProcStepVO.setProcStCd(nextProcStCd);
        mrReqProcStepVO.setMrStepCd(currentMrStepCd);
        mrStepRepository.updateProcStep(mrReqProcStepVO);		//MR_REQ_PROC_STEP UPDATE
        mrStepRepository.updateMrReqStep(mrReqProcStepVO);		//MR_REQ_MST UPDATE

        MrReqProcStepDetVO mrReqProcStepDetVO = new MrReqProcStepDetVO();
        mrReqProcStepDetVO.setMrReqNo(mrReqNo);
        mrReqProcStepDetVO.setMrStepCd(currentMrStepCd);
        mrReqProcStepDetVO.setProcStCd(nextProcStCd);
        mrReqProcStepDetVO.setFstProcTrmDt(getAppTerm());
        mrStepRepository.insertMrReqProcStepDetForStepLast(mrReqProcStepDetVO);

        ChrgrChgHist chrgrChgHist = mrStepRepository.selectAppLine(mrReqNo, getMrStepCd, getChrgrClCd);
        chrgrChgHist.setMrReqNo(mrReqNo);
        chrgrChgHist.setProcStCd(nextProcStCd);
        chrgrChgHist.setChrgrClCd(nextChrgrClCd);
        chrgrChgHist.setMrReqProcStepDetNo(mrReqProcStepDetVO.getMrReqProcStepDetNo());
        mrStepRepository.insertChrgrChgHist(chrgrChgHist);
    }

    @Override
    public void updateAppLine(int mrReqNo, List<ChrgrChgHist> appLine, List<String> chrgrClCds) {

        boolean isContain = false;
        ChrgrChgHist appInfo = mrStepRepository.selectAppStepEmp(mrReqNo, null);
        appInfo.setChrgrClCds(chrgrClCds);
        mrStepRepository.updateAppLineDelYn(appInfo);

        for (ChrgrChgHist chrgrChgHist: appLine) {
            isContain = false;
            for(String chrgrClCd : chrgrClCds){
                if(chrgrChgHist.getChrgrClCd().equals(chrgrClCd)) {
                    isContain = true;
                }
            }

            if(isContain==false) {
                continue;
            }

            MrReqProcStepDetVO mrReqProcStepDetVO = new MrReqProcStepDetVO();
            mrReqProcStepDetVO.setMrReqNo(mrReqNo);
            mrReqProcStepDetVO.setMrReqProcStepNo(appInfo.getMrReqProcStepNo());
            mrReqProcStepDetVO.setMrStepCd(appInfo.getMrStepCd());
            mrReqProcStepDetVO.setProcStCd(appInfo.getProcStCd());
            mrReqProcStepDetVO.setFstProcTrmDt(chrgrChgHist.getProcTrmDt());
            mrStepRepository.insertMrReqProcStepDet(mrReqProcStepDetVO);

            chrgrChgHist.setMrReqNo(mrReqNo);
            chrgrChgHist.setMrReqProcStepDetNo(mrReqProcStepDetVO.getMrReqProcStepDetNo());
            mrStepRepository.insertChrgrChgHist(chrgrChgHist);
        }
    }

    @Override
    public void insertNextStepForJobs(int mrReqNo) {
        //종료 플래그 추가
        MrReqProcStepVO mrReqProcStepVO = new MrReqProcStepVO();
        mrReqProcStepVO.setMrReqNo(mrReqNo);
        mrReqProcStepVO.setProcStCd("Z0132");
        mrStepRepository.updateProcStep(mrReqProcStepVO);

        //결재상태 마감
        ChrgrChgHist stepEffEnd = new ChrgrChgHist();
        stepEffEnd.setMrReqNo(mrReqNo);
        mrStepRepository.updateProcStepEffEnd(stepEffEnd);

        List<ChrgrChgHist> appInfoList = mrStepRepository.selectMrAllAppLine(mrReqNo);

        mrReqProcStepVO.setMrReqNo(mrReqNo);
        mrReqProcStepVO.setMrStepCd("Z0050");
        mrReqProcStepVO.setProcStCd("Z0110");
        mrStepRepository.insertProcStep(mrReqProcStepVO);
        mrStepRepository.updateMrReqStep(mrReqProcStepVO);

        MrReqProcStepDetVO mrReqProcStepDetVO = new MrReqProcStepDetVO();
        mrReqProcStepDetVO.setMrReqNo(mrReqNo);
        mrReqProcStepDetVO.setMrReqProcStepNo(mrReqProcStepVO.getMrReqProcStepNo());
        mrReqProcStepDetVO.setMrStepCd("Z0050");
        mrReqProcStepDetVO.setProcStCd("Z0110");
        mrReqProcStepDetVO.setFstProcTrmDt(getAppTerm());
        mrStepRepository.insertMrReqProcStepDet(mrReqProcStepDetVO);

        //결재라인에 사업수행팀 팀장 기술검토 팀장 추가.
        for(ChrgrChgHist chrgrChgHist : appInfoList) {
            if(chrgrChgHist.getChrgrClCd().equals("Z02D")) {
                chrgrChgHist.setMrReqNo(mrReqNo);
                chrgrChgHist.setFstProcTrmDt(getAppTerm());
                chrgrChgHist.setProcStCd("Z0110");
                chrgrChgHist.setMrReqProcStepDetNo(mrReqProcStepDetVO.getMrReqProcStepDetNo());
                mrStepRepository.insertChrgrChgHist(chrgrChgHist);
            }
        }
    }

    @Override
    public void insertNextAppEmp(int mrReqNo, String nextProcStCd) {

        ChrgrChgHist appInfo = mrStepRepository.selectAppStepEmp(mrReqNo, null);
        if (appInfo!=null) {

            mrStepRepository.updateAppLineEffEnd(appInfo);

            //단계업데이트
            if(nextProcStCd!=null) {
                MrReqProcStepVO mrReqProcStepVO = new MrReqProcStepVO();
                mrReqProcStepVO.setMrReqNo(mrReqNo);
                mrReqProcStepVO.setMrStepCd(appInfo.getMrStepCd());
                mrReqProcStepVO.setProcStCd(nextProcStCd);
                mrStepRepository.updateProcStep(mrReqProcStepVO);
                mrStepRepository.updateMrReqStep(mrReqProcStepVO);
            } else {
                nextProcStCd = appInfo.getProcStCd();
            }

            MrReqProcStepDetVO mrReqProcStepDetVO = new MrReqProcStepDetVO();
            mrReqProcStepDetVO.setMrReqNo(mrReqNo);
            mrReqProcStepDetVO.setMrReqProcStepNo(appInfo.getMrReqProcStepNo());
            mrReqProcStepDetVO.setMrStepCd(appInfo.getMrStepCd());
            mrReqProcStepDetVO.setProcStCd(nextProcStCd);
            mrStepRepository.insertMrReqProcStepDet(mrReqProcStepDetVO);

            appInfo.setMrReqProcStepDetNo(mrReqProcStepDetVO.getMrReqProcStepDetNo());
            mrStepRepository.insertChrgrChgHist(appInfo);
        }
    }

    //초기투자비 멀티 담당자 관련 
    @Override
    public void insertNextAppEmpMulti(int mrReqNo, String nextProcStCd) {

    	//결재자 여러명이 동시에 처리시 결재자정보 조회
        List<ChrgrChgHist> appInfoList = mrStepRepository.selectAppStepEmpMulti(mrReqNo);        
        
        //System.out.println("초기투자비 멀티 담당자 관련  nextProcStCd: ");
        
        if(appInfoList.size() >0){
        	for(ChrgrChgHist appInfo : appInfoList){
		        if (appInfo!=null) {
		        	
		        	//결재라인 유효기간 종료
		        	//System.out.println("결재라인 유효기간 종료 updateAppLineEffEnd: ");
		        	
		            mrStepRepository.updateAppLineEffEnd(appInfo);
		
		            //단계업데이트
		            if(nextProcStCd!=null) {
		                MrReqProcStepVO mrReqProcStepVO = new MrReqProcStepVO();
		                mrReqProcStepVO.setMrReqNo(mrReqNo);
		                mrReqProcStepVO.setMrStepCd(appInfo.getMrStepCd());
		                mrReqProcStepVO.setProcStCd(nextProcStCd);
		                
		                //Step 변경
		                mrStepRepository.updateProcStep(mrReqProcStepVO);
		                
		                //마스터 테이블 STEP 업데이트
		                mrStepRepository.updateMrReqStep(mrReqProcStepVO);
		                
		                //System.out.println("단계업데이트  ");
		            } else {
		                nextProcStCd = appInfo.getProcStCd();
		                //System.out.println("단계업데이트 else  ");
		            }		
		
		            MrReqProcStepDetVO mrReqProcStepDetVO = new MrReqProcStepDetVO();
		            mrReqProcStepDetVO.setMrReqNo(mrReqNo);
		            mrReqProcStepDetVO.setMrReqProcStepNo(appInfo.getMrReqProcStepNo());
		            mrReqProcStepDetVO.setMrStepCd(appInfo.getMrStepCd());
		            mrReqProcStepDetVO.setProcStCd(nextProcStCd);
		            
		            //상세 Step 생성
		            mrStepRepository.insertMrReqProcStepDet(mrReqProcStepDetVO);
		
		            appInfo.setMrReqProcStepDetNo(mrReqProcStepDetVO.getMrReqProcStepDetNo());
		            
		            //결재라인 생성
		            mrStepRepository.insertChrgrChgHist(appInfo);
		        }
        	}
        }
    }
    
    // 진행단계 업데이트
    @Override
    public int insertPrevAppEmp(int mrReqNo, String mrStepCd, String prevProcStCd, List<ChrgrChgHist> appLine, String chrgrClCd) {
        int mrReqProcStepNo = 0;
        MrReqProcStepDetVO mrReqProcStepDetVO = null;
        ChrgrChgHist appInfo = mrStepRepository.selectAppStepEmp(mrReqNo, null);	//현재 결재자 정보
        MrReqProcStepVO mrReqProcStepVO = new MrReqProcStepVO();
        mrReqProcStepVO.setMrReqNo(mrReqNo);
        mrReqProcStepVO.setMrStepCd(appInfo.getMrStepCd());
        mrReqProcStepVO.setProcStCd(prevProcStCd);

        if(mrStepCd!=null) {
            mrReqProcStepVO.setMrStepCd(mrStepCd);
        }
        
        //MR_REQ_PROC_STEP(MR진행단계) update
        mrStepRepository.updateProcStep(mrReqProcStepVO);
        
        //MR_REQ_MST(MR요청) update
        mrStepRepository.updateMrReqStep(mrReqProcStepVO);

        //MR_REQ_CHRGR_CHG_HIST(MR처리담당자 변경이력) update
        mrStepRepository.updateAppLineAllEffEnd(appInfo);

        if(appLine != null) {
            for (ChrgrChgHist chrgrChgHist: appLine) {
                mrReqProcStepDetVO = new MrReqProcStepDetVO();
                mrReqProcStepDetVO.setMrReqNo(mrReqNo);
                mrReqProcStepDetVO.setMrReqProcStepNo(appInfo.getMrReqProcStepNo());

                //System.out.println("insertPrevAppEmp mrStepCd : " + mrStepCd);
                if(mrStepCd==null) {
                    mrReqProcStepDetVO.setMrStepCd(appInfo.getMrStepCd());
                } else {
                    mrReqProcStepDetVO.setMrStepCd(mrStepCd);
                }

                mrReqProcStepDetVO.setProcStCd(prevProcStCd);
                mrReqProcStepDetVO.setFstProcTrmDt(chrgrChgHist.getProcTrmDt());
                if(chrgrClCd.equals(chrgrChgHist.getChrgrClCd())) {
                    mrReqProcStepDetVO.setFstProcTrmDt(getAppTerm());
                }
                mrStepRepository.insertMrReqProcStepDet(mrReqProcStepDetVO);

                chrgrChgHist.setMrReqNo(mrReqNo);
                chrgrChgHist.setMrReqProcStepDetNo(mrReqProcStepDetVO.getMrReqProcStepDetNo());
                 int test = mrStepRepository.insertChrgrChgHist(chrgrChgHist);
                 //System.out.println("test : " + test);
            }
        } else {
            //특정 Step에서 chrgrClCd가 일치하는 정보 가져오기.
            ChrgrChgHist chrgrChgHist = mrStepRepository.selectAppLine(mrReqNo, mrStepCd, chrgrClCd);
            if(chrgrChgHist == null){
                for( ChrgrChgHist inChrgrChgHist : mrStepRepository.selectMrAllAppLine(mrReqNo)){
                    if(inChrgrChgHist.getChrgrClCd().equals(chrgrClCd)){
                        chrgrChgHist = inChrgrChgHist;
                        chrgrChgHist.setProcStCd(prevProcStCd);
                        break;
                    }
                }
            }
            
            mrReqProcStepDetVO = new MrReqProcStepDetVO();
            mrReqProcStepDetVO.setMrReqNo(mrReqNo);
            mrReqProcStepDetVO.setMrReqProcStepNo(appInfo.getMrReqProcStepNo());
            if(mrStepCd==null) {
                mrReqProcStepDetVO.setMrStepCd(appInfo.getMrStepCd());
            } else {
                mrReqProcStepDetVO.setMrStepCd(mrStepCd);
            }
            mrReqProcStepDetVO.setProcStCd(prevProcStCd);
            mrReqProcStepDetVO.setFstProcTrmDt(getAppTerm());
            mrStepRepository.insertMrReqProcStepDet(mrReqProcStepDetVO);

            chrgrChgHist.setMrReqNo(mrReqNo);
            chrgrChgHist.setMrReqProcStepDetNo(mrReqProcStepDetVO.getMrReqProcStepDetNo());
            mrStepRepository.insertChrgrChgHist(chrgrChgHist);	//mr처리 담당자 변경이력
        }

        mrReqProcStepNo = appInfo.getMrReqProcStepNo();
        return mrReqProcStepNo;
    }

    @Override
    public void insertIsolationNextAppEmp(int mrReqNo, String mrStepCd, String nextProcStCd) {

        ChrgrChgHist appInfo = mrStepRepository.selectAppIsolationStepEmp(mrReqNo, mrStepCd, null);
        if (appInfo!=null) {

            mrStepRepository.updateAppLineEffEnd(appInfo);

            MrReqProcStepDetVO mrReqProcStepDetVO = new MrReqProcStepDetVO();
            mrReqProcStepDetVO.setMrReqNo(mrReqNo);
            mrReqProcStepDetVO.setMrReqProcStepNo(appInfo.getMrReqProcStepNo());
            mrReqProcStepDetVO.setMrStepCd(appInfo.getMrStepCd());
            mrReqProcStepDetVO.setProcStCd(nextProcStCd);
            mrStepRepository.insertMrReqProcStepDet(mrReqProcStepDetVO);

            appInfo.setMrReqProcStepDetNo(mrReqProcStepDetVO.getMrReqProcStepDetNo());
            mrStepRepository.insertChrgrChgHist(appInfo);
        }
    }

    @Override
    public int insertIsolationPrevAppEmp(int mrReqNo, String mrStepCd, String prevProcStCd, List<ChrgrChgHist> appLine, String chrgrClCd) {
        int mrReqProcStepNo = 0;
        MrReqProcStepDetVO mrReqProcStepDetVO = null;
        ChrgrChgHist appInfo = mrStepRepository.selectAppIsolationStepEmp(mrReqNo, mrStepCd, null);

        mrStepRepository.updateAppLineAllEffEnd(appInfo);

        for (ChrgrChgHist chrgrChgHist: appLine) {
            mrReqProcStepDetVO = new MrReqProcStepDetVO();
            mrReqProcStepDetVO.setMrReqNo(mrReqNo);
            mrReqProcStepDetVO.setMrReqProcStepNo(appInfo.getMrReqProcStepNo());

            if(mrStepCd==null) {
                mrReqProcStepDetVO.setMrStepCd(appInfo.getMrStepCd());
            } else {
                mrReqProcStepDetVO.setMrStepCd(mrStepCd);
            }

            mrReqProcStepDetVO.setProcStCd(prevProcStCd);
            mrReqProcStepDetVO.setFstProcTrmDt(chrgrChgHist.getProcTrmDt());

            if(chrgrClCd.equals(chrgrChgHist.getChrgrClCd())) {
                mrReqProcStepDetVO.setFstProcTrmDt(getAppTerm());
            }

            mrStepRepository.insertMrReqProcStepDet(mrReqProcStepDetVO);

            chrgrChgHist.setMrReqNo(mrReqNo);
            chrgrChgHist.setMrReqProcStepDetNo(mrReqProcStepDetVO.getMrReqProcStepDetNo());
            mrStepRepository.insertChrgrChgHist(chrgrChgHist);
        }

        mrReqProcStepNo = appInfo.getMrReqProcStepNo();
        return mrReqProcStepNo;
    }


    @Override
    public void updateMrStepEffEnd(int mrReqNo) {
        ChrgrChgHist appInfo = mrStepRepository.selectAppStepEmp(mrReqNo, null);
        mrStepRepository.updateProcStepEffEnd(appInfo);
        MrReqProcStepVO mrReqProcStepVO = new MrReqProcStepVO();
        mrReqProcStepVO.setMrReqNo(mrReqNo);
        mrReqProcStepVO.setMrStepCd("Z00Z0");
        mrReqProcStepVO.setProcStCd("Z0143");
        mrStepRepository.insertProcStep(mrReqProcStepVO);
        mrStepRepository.updateMrReqStep(mrReqProcStepVO);
    }

    @Override
    public void updateMrAppLineEffEnd(int mrReqNo) {
        ChrgrChgHist appInfo = mrStepRepository.selectAppStepEmp(mrReqNo, null);
        mrStepRepository.updateAppLineAllEffEnd(appInfo);
    }

    @Deprecated
    @Override
    public void updateMrAppLine(int mrReqNo, String mrStepCd, String procStCd, List<ChrgrChgHist> appLine) {

        //논리 삭제를 위하여 담당자 변경 객체 생성
        //mrReqNo를 셋팅하고 있으나 객체 생성시 자동으로 loginEmp를 세션으로 부터 얻어옴.
        ChrgrChgHist appLineInfo = new ChrgrChgHist();
        appLineInfo.setMrReqNo(mrReqNo);
        appLineInfo.setMrStepCd(mrStepCd);
        appLineInfo.setProcStCd(procStCd);


        int mrReqProcStepNo = mrStepRepository.getMrReqProcStepNo(appLineInfo);

        mrStepRepository.updateMrReqProcStepDetDelYn(appLineInfo);
        mrStepRepository.updateAppLineDelYn(appLineInfo);

        for (ChrgrChgHist chrgrChgHist: appLine) {
            MrReqProcStepDetVO mrReqProcStepDetVO = new MrReqProcStepDetVO();
            mrReqProcStepDetVO.setMrReqNo(mrReqNo);
            mrReqProcStepDetVO.setMrReqProcStepNo(mrReqProcStepNo);
            mrReqProcStepDetVO.setMrStepCd(mrStepCd);
            mrReqProcStepDetVO.setProcStCd(procStCd);
            mrReqProcStepDetVO.setFstProcTrmDt(chrgrChgHist.getProcTrmDt());
            mrStepRepository.insertMrReqProcStepDet(mrReqProcStepDetVO);

            chrgrChgHist.setMrReqNo(mrReqNo);
            chrgrChgHist.setMrReqProcStepDetNo(mrReqProcStepDetVO.getMrReqProcStepDetNo());
            mrStepRepository.insertChrgrChgHist(chrgrChgHist);
        }
    }


    @Override
    public int updateTechEmpDelYn(ChrgrChgHist chrgrChgHist) {
        return mrStepRepository.updateTechEmpDelYn(chrgrChgHist);
    }


    @Override
    public void insertMrStep(int mrReqNo, String mrStepCd, String procStCd, String chrgrClCd) {

        ChrgrChgHist chrgrChgHist = mrStepRepository.selectAppStepEmp(mrReqNo, chrgrClCd);
        chrgrChgHist.setMrReqNo(mrReqNo);
        mrStepRepository.updateProcStepEffEnd(chrgrChgHist);

        MrReqProcStepVO mrReqProcStepVO = new MrReqProcStepVO();
        mrReqProcStepVO.setMrReqNo(mrReqNo);
        mrReqProcStepVO.setMrStepCd(mrStepCd);
        mrReqProcStepVO.setProcStCd(procStCd);
        mrStepRepository.insertProcStep(mrReqProcStepVO);
        mrStepRepository.updateMrReqStep(mrReqProcStepVO);

        MrReqProcStepDetVO mrReqProcStepDetVO = new MrReqProcStepDetVO();
        mrReqProcStepDetVO.setMrReqNo(mrReqNo);
        mrReqProcStepDetVO.setMrReqProcStepNo(mrReqProcStepVO.getMrReqProcStepNo());
        mrReqProcStepDetVO.setMrStepCd(mrStepCd);
        mrReqProcStepDetVO.setProcStCd(procStCd);
        mrReqProcStepDetVO.setFstProcTrmDt(getAppTerm());
        mrStepRepository.insertMrReqProcStepDet(mrReqProcStepDetVO);

        chrgrChgHist.setProcStCd(procStCd);
        chrgrChgHist.setMrReqProcStepDetNo(mrReqProcStepDetVO.getMrReqProcStepDetNo());
        mrStepRepository.insertChrgrChgHist(chrgrChgHist);
    }



    @Override
    public void insertPorcAppLine(int mrReqNo, String mrStepCd, String procStCd, List<ChrgrChgHist> appLine, boolean isAction) {

        ChrgrChgHist appInfo = mrStepRepository.selectAppStepEmp(mrReqNo, null);


        for (ChrgrChgHist chrgrChgHist: appLine) {
            if(chrgrChgHist.getChrgEmpNo() ==null) {
                continue;
            }
            MrReqProcStepDetVO mrReqProcStepDetVO = new MrReqProcStepDetVO();
            mrReqProcStepDetVO.setMrReqNo(mrReqNo);
            mrReqProcStepDetVO.setMrReqProcStepNo(appInfo.getMrReqProcStepNo());
            mrReqProcStepDetVO.setMrStepCd(mrStepCd);
            mrReqProcStepDetVO.setProcStCd(procStCd);
            if(isAction){
                mrReqProcStepDetVO.setFstProcTrmDt(getAppTerm());
            } else {
                mrReqProcStepDetVO.setFstProcTrmDt(null);
            }
            updatePorcAppLineDel(chrgrChgHist);
            mrStepRepository.insertMrReqProcStepDet(mrReqProcStepDetVO);

            chrgrChgHist.setMrReqNo(mrReqNo);
            chrgrChgHist.setMrReqProcStepDetNo(mrReqProcStepDetVO.getMrReqProcStepDetNo());
            mrStepRepository.insertChrgrChgHist(chrgrChgHist);
        }
    }


    /**
     * 기본기한일을 자동으로 기본 appConfig에 따라 셋팅하게 된다.
     * @return
     */
    @Override
    public Date getAppTerm(){
        SimpleDateFormat transFormat = new SimpleDateFormat("yyyy-MM-dd");
        GregorianCalendar cal = new GregorianCalendar();
        Date to = null;
        try {
            // resources\config\app-config.xml <default> 하위에 <term>에서 셋팅하는 값에 따라 자동 셋팅
            int defaultTerm = appConfig.getInt("default.term");
            cal.add(Calendar.DATE, defaultTerm);
            to = transFormat.parse(transFormat.format(cal.getTime()));
        } catch (ParseException e) {
            logger.debug(e.getStackTrace());
        }
        return to;
    }


    /**
     * 9999-12-31 날짜를 Date 형태로 변환하여 반환.
     * @return
     */
    @Override
    public Date get99991231(String endDate){
        SimpleDateFormat transFormat = new SimpleDateFormat("yyyy-MM-dd");
        Date to = null;
        try {
            if(endDate==null) {
                endDate="9999-12-31";
            }
            to = transFormat.parse(endDate);
        } catch (ParseException e) {
            //logger.debug(e.getStackTrace());
        }
        return to;
    }


    @Override
    public void updatePorcAppLineDel(ChrgrChgHist chrgrChgHist) {
        mrStepRepository.updatePorcEmpDelYn(chrgrChgHist);
        mrStepRepository.updatePorcStepDetDelYn(chrgrChgHist);
    }


    @Override
    public void updateAppLineDel(int mrReqNo, String mrStepCd) {
        ChrgrChgHist chrgrChgHist = new ChrgrChgHist();
        chrgrChgHist.setMrReqNo(mrReqNo);
        chrgrChgHist.setMrStepCd(mrStepCd);
        mrStepRepository.updateAppLineDelYn(chrgrChgHist);
        mrStepRepository.updateMrReqProcStepDetDelYn(chrgrChgHist);
    }

    @Override
    public int updateMrReqProcStepDetJobRvCd(int mrReqProcStepDetNo, String jobRvCd) {
        return mrStepRepository.updateMrReqProcStepDetJobRvCd(mrReqProcStepDetNo, jobRvCd);
    }

    /* 요청서 저장
     * 첨부파일 저장
     * */
    @Override
    public int insertFile(int mrReqNo, String mrStepCd, String chrgrClCd, String fileStepCd, List<MrAtchFile> mrAtchFiles){
    	
        int insertCount = 0;
        if (CollectionUtils.isNotEmpty(mrAtchFiles)) {
        	
            List<MrAtchFile> saveMrAtchFiles = mrAtchFileService.saveMrAtchFiles(mrAtchFiles);
            //System.out.println("saveMrAtchFiles:"+ saveMrAtchFiles );
            for (MrAtchFile mrAtchFile : saveMrAtchFiles) {
            	
            	//System.out.println("chrgrClCd:"+ chrgrClCd + " mrStepCd:"+mrStepCd  + " fileStepCd:"+fileStepCd  + " mrAtchFile:"+mrAtchFile );
            	
                mrAtchFile.setMrReqNo(mrReqNo);
                mrAtchFile.setMrStepCd(mrStepCd);
                mrAtchFile.setChrgrClCd(chrgrClCd);
                mrAtchFile.setFileStepCd(fileStepCd);
                
                System.out.println("mrAtchFile.isDeleted():"+ mrAtchFile.isDeleted()+ "    mrAtchFile.isInserted():"+ mrAtchFile.isInserted() );
                
                //202009 mrAtchFile.isInserted() 인식이 안됨  mrAtchFileRepository.insertMrAtchFile(mrAtchFile); 해당 메소스 실행해서 insert 쿼리 확인
                if(!mrAtchFile.isDeleted() && mrAtchFile.isInserted()) {
                	System.out.println("★★★★★★★★★★★★★★★★★★★★★ insertMrAtchFile  start★★★★★★★★★★★★★★★★★★★★★ ");
                    mrAtchFileRepository.insertMrAtchFile(mrAtchFile);
                    System.out.println("★★★★★★★★★★★★★★★★★★★★★ insertMrAtchFile  start★★★★★★★★★★★★★★★★★★★★★ ");
                } else if(mrAtchFile.isDeleted()) {
                	//System.out.println("mrAtchFile.isDeleted()" );
                    mrAtchFileRepository.deleteMrAtchFile(mrAtchFile.getMrAtchFileNo());
                }

                insertCount++;
            }
        }
        return insertCount;
    }


	@Override
	public List<ChrgrChgHist> getMrReqTechEmpInfo(int mrReqNo,List<String> mrStepCds, List<String> chrgrClCds) {
		return mrStepRepository.getMrReqTechEmpInfo(mrReqNo,mrStepCds,chrgrClCds);
	}


	@Override
	public void updateReqTechEmpDelYn(ChrgrChgHist mrReqTechEmpInfo) {
		mrStepRepository.updateReqTechEmpDelYn(mrReqTechEmpInfo);
	}


	@Override
	public void insertChrgrChgHist(ChrgrChgHist mrReqTechEmpInfo) {
		mrStepRepository.insertChrgrChgHist(mrReqTechEmpInfo);
	}


	@Override
	public MrReqProcStepVO selectOneMrReqStep(int mrReqNo, String mrStepCd) {
		return mrStepRepository.selectOneMrReqStep(mrReqNo, mrStepCd);
	}


	@Override
	public void updatePorcStepDetNoDelYn(ChrgrChgHist delActEmpInfo) {
		mrStepRepository.updatePorcStepDetNoDelYn(delActEmpInfo);
		
	}


	@Override
	public void updateAppLineEffEnd(ChrgrChgHist delActEmpInfo) {
		mrStepRepository.updateAppLineEffEnd(delActEmpInfo);
		
	}


	@Override
	public void insertMrReqProcStepDet(MrReqProcStepDetVO actMrReqProcStepDet) {
		mrStepRepository.insertMrReqProcStepDet(actMrReqProcStepDet);
		
	}


    /**
     * 요청서 결재 연동 상태 수정
     */
    @Override
    public void updateMrIfStat01(MrReqProcStepDetVO mrReqProcStepDetVO) {
    	mrStepRepository.updateMrIfStat01(mrReqProcStepDetVO);
        //return 1; 
    }


	@Override
    public void updateDetHistDel(int mrReqNo, String procStCd, String stepCd, String chrgrClCd) {        
        mrStepRepository.updateDetHistDel(mrReqNo, procStCd, stepCd, chrgrClCd);
	}

}
