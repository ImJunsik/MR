package com.common.file.web;

import javax.servlet.http.HttpServletRequest;

import org.apache.commons.configuration.XMLConfiguration;
import org.apache.commons.lang3.StringUtils;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.servlet.ModelAndView;
import org.springframework.web.servlet.View;

import com.base.servlet.BaseController;
import com.base.servlet.view.FileDownloadView;
import com.common.file.domain.AttachFile;
import com.common.file.service.AttachFileService;

/**
 * 첨부파일 다운로드 및 첨부파일 관련 Front-End의 요청 처리를 담당한다.
 *
 * @author 조용상
 * @version 1.0
 *
 * <pre>
 * 수정일 | 수정자 | 수정내용
 * ---------------------------------------------------------------------
 * 2014.01.27 조용상 최초 작성
 * </pre>
 */
@Controller
@RequestMapping(value = "/")
public class AttachFileController extends BaseController {
    @Autowired
    private AttachFileService attachFileService;

    @Autowired
    protected XMLConfiguration appConfig;

    /**
     * 첨부파일 다운로드를 한다.
     * @param code 첨부파일 코드
     * @param request HttpServletRequest 요청 객체
     * @return FileDownloadView or DocumentView
     */
    @RequestMapping("/download.do")
    public ModelAndView download(@RequestParam String drawMngNo, HttpServletRequest request) {
        //View view = request.getRequestURI().endsWith("/download.do") ? new FileDownloadView() : new DocumentView();
        View view = new FileDownloadView();
        ModelAndView modelAndView = new ModelAndView(view);

        if (StringUtils.isNotEmpty(drawMngNo)) {
            AttachFile attachFile = attachFileService.getAttachFileDrawMngNo(drawMngNo);
            modelAndView.addObject("downloadFile", attachFile.getAttachedFile());
            modelAndView.addObject("originalFilename", attachFile.getName());
            return modelAndView;
        }
        return modelAndView;
    }
}